<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="invert_pendulum_URDF">

    <xacro:include filename="inertial_macros.xacro" />
    <xacro:include filename="pendulum_params.xacro" />
    <xacro:include filename="robot_material.xacro" />
    <xacro:include filename="gazebo_full.xacro" />
    
    <!-- WORLD LINK (Fixed to ground) -->
    <link name="world"/>
    
    <!-- FIXED JOINT (Base stuck to ground - no cart movement) -->
    <joint name="base" type="fixed">
        <parent link="world"/>
        <child link="base_link"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>  <!-- Base origin at ground level -->
    </joint>
    
    <!-- BASE LINK (CART) -->
    <link name="base_link">
        <inertial>
            <origin xyz="4.35011143188239E-06 -4.26974202710915E-05 0.0926893522450359" rpy="0 0 0" />
            <mass value="${mass_base}" />
            <inertia
                ixx="0.00149406454043322"
                ixy="4.12697804108289E-09"
                ixz="-7.65282756367958E-08"
                iyy="0.00140648625642533"
                iyz="8.80770910699998E-10"
                izz="0.000630646344660402" />
        </inertial>
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://double_invert_pendulum_description/meshes/base_link.STL" />
            </geometry>
            <material name="light_blue"/>
        </visual>
        <collision>
            <!-- Using box primitive for better collision physics -->
            <!-- Box positioned to match the base geometry -->
            <origin xyz="0 0 0.09" rpy="0 0 0" />
            <geometry>
                <box size="0.25 0.15 0.18"/>
            </geometry>
        </collision>
    </link>

    <!-- REVOLUTE LINK -->
    <joint name="revolute_joint" type="revolute">
        <parent link="base_link"/>
        <child link="revolute_Link"/>
        <origin xyz="${revolute_joint_x} ${revolute_joint_y} ${revolute_joint_z}" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit effort="${joint_effort}" velocity="${joint_velocity}" lower="${joint_lower_limit}" upper="${joint_upper_limit}"/>
        <dynamics damping="${revolute_joint_damping}" friction="${revolute_joint_friction}"/>
    </joint>

    <link name="revolute_Link">
        <inertial>
            <origin xyz="-0.0175370700578145 -0.00016469410235089 0.00111078231813694" rpy="0 0 0" />
            <mass value="${mass_revolute}" />
            <inertia
                ixx="5.58988467068262E-05"
                ixy="-2.47845250293903E-09"
                ixz="-6.15261336732486E-09"
                iyy="8.47733759009359E-05"
                iyz="4.85611321474861E-09"
                izz="0.000107267938774701" />
        </inertial>
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://double_invert_pendulum_description/meshes/revolute_Link.STL" />
            </geometry>
            <material name="brown"/>
        </visual>
        <collision>
            <!-- Using cylinder primitive for revolute joint housing -->
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <cylinder radius="0.03" length="0.05"/>
            </geometry>
        </collision>
    </link>

    <!-- FIRST PENDULUM LINK -->
    <joint name="first_pendulum_joint" type="revolute">
        <parent link="revolute_Link"/>
        <child link="first_pendulum_link"/>
        <origin xyz="${pendulum1_joint_x} ${pendulum1_joint_y} ${pendulum1_joint_z}" rpy="1.5708 0 -1.5708"/>
        <axis xyz="0 0 1"/>
        <limit effort="${joint_effort}" velocity="${joint_velocity}" lower="${joint_lower_limit}" upper="${joint_upper_limit}"/>
        <dynamics damping="${first_pendulum_damping}" friction="${first_pendulum_friction}"/>
    </joint>

    <link name="first_pendulum_link">
        <inertial>
            <origin xyz="-1.00551614541671E-07 -0.0646186151454772 -0.00362087479361183" rpy="0 0 0" />
            <mass value="${mass_pendulum1}" />
            <inertia
                ixx="0.000174588068807012"
                ixy="-2.95045790870356E-10"
                ixz="2.21709158691471E-11"
                iyy="6.96835664909535E-06"
                iyz="5.24978381703527E-07"
                izz="0.000169216758156749" />
        </inertial>
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://double_invert_pendulum_description/meshes/first_pendulum_link.STL" />
            </geometry>
            <material name="brown"/>
        </visual>
        <collision>
            <!-- Using box primitive for first pendulum rod -->
            <origin xyz="0 -0.065 0" rpy="0 0 0" />
            <geometry>
                <box size="0.02 0.14 0.02"/>
            </geometry>
        </collision>
    </link>

    <!-- SECOND PENDULUM LINK -->
    <joint name="second_pendulum_joint" type="revolute">
        <parent link="first_pendulum_link"/>
        <child link="second_pendulum_link"/>
        <origin xyz="${pendulum2_joint_x} ${pendulum2_joint_y} ${pendulum2_joint_z}" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit effort="${joint_effort}" velocity="${joint_velocity}" lower="${joint_lower_limit}" upper="${joint_upper_limit}"/>
        <dynamics damping="${second_pendulum_damping}" friction="${second_pendulum_friction}"/>
    </joint>

    <link name="second_pendulum_link">
        <inertial>
            <origin xyz="-2.8765755728709E-06 -0.0299439674255459 0.00119447713150889" rpy="0 0 0" />
            <mass value="${mass_pendulum2}" />
            <inertia
                ixx="1.8911424822564E-06"
                ixy="-9.8432286079085E-12"
                ixz="2.35767361175274E-10"
                iyy="2.84550526022121E-07"
                iyz="3.87915762114474E-08"
                izz="2.05641965585819E-06" />
        </inertial>
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://double_invert_pendulum_description/meshes/second_pendulum_link.STL" />
            </geometry>
            <material name="light_blue"/>
        </visual>
        <collision>
            <!-- Using box primitive for second pendulum rod -->
            <origin xyz="0 -0.03 0" rpy="0 0 0" />
            <geometry>
                <box size="0.015 0.06 0.015"/>
            </geometry>
        </collision>
    </link>

</robot>